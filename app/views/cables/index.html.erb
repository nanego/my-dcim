<%
  title = Connection.model_name.human.pluralize
  breadcrumb_steps = { title => "" }

  provide(:title, title)
%>

<%= render Page::HeadingComponent.new(title:, breadcrumb_steps:) %>

<div class="p-4 border-top d-flex flex-column row-gap-4">
  <%= render FilterComponent.new(@filter) do |c| %>
    <% c.with_form do |f| %>
      <div>
        <fieldset class="form-floating">
          <%= f.collection_select(:server_ids, Server.no_pdus.order(:name),
                                  :id,
                                  :to_s,
                                  { prompt: true, multiple: true },
                                  { class: "form-select",
                                    data: { controller: :select, select_options_value: { maxOptions: nil } } }) %>
          <%= f.label :server_ids %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.select(:special_case,
                       CableDecorator.special_case_options_for_select,
                       { prompt: true },
                       { class: "form-select", data: { controller: :select } }) %>
          <%= f.label :special_case %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.collection_select(:port_type_ids, PortType.order(:name),
                                  :id,
                                  :name,
                                  { prompt: true, multiple: true },
                                  { class: "form-select", data: { controller: :select } }) %>
          <%= f.label :port_type_ids %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.select(:colors,
                       CableDecorator.colors_options_for_select,
                       { prompt: true, multiple: true },
                       { class: "form-select", data: { controller: :select } }) %>
          <%= f.label :colors %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.text_field :cable_name, class: "form-control", placeholder: t("filters.placeholder.search") %>
          <%= f.label :cable_name %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.text_field :card_query, class: "form-control", placeholder: t("filters.placeholder.search") %>
          <%= f.label :card_query %>
        </fieldset>
      </div>

      <div>
        <fieldset class="form-floating">
          <%= f.text_field :comments, class: "form-control", placeholder: t("filters.placeholder.search") %>
          <%= f.label :comments %>
        </fieldset>
      </div>
    <% end %>
  <% end %>

  <%= turbo_frame_tag(dom_id(Connection, :table), data: { turbo_action: :advance }) do %>
    <div class="cable-index-servers d-flex flex-column row-gap-4">
      <%= render List::DataTableComponent.new(@cables) do |table| %>
        <% table.with_column("Matériels connectés") do |cable| %>
          <%= cable.decorated.connected_servers %>
        <% end %>

        <% table.with_column(Cable.human_attribute_name(:special_case), sort_by: :special_case, class: "text-center") do |cable| %>
          <%= cable.special_case ? t("boolean.true") : t("boolean.false") %>
        <% end %>

        <% table.with_column(Cable.human_attribute_name(:comments), sort_by: :comments) do |cable| %>
          <%= cable.comments %>
        <% end %>

        <% table.with_column(style: "min-width: 50px; width: 50px") do |cable| %>
          <div class="btn-group btn-group-sm" role="group" aria-label="...">
            <%= link_to connections_edit_path(from_port_id: cable.ports.first), class: "btn btn-info" do %>
              <span class="bi bi-pencil" title="<%= t("action.edit") %>" aria-hidden="true"
                                                                        data-controller="tooltip"
                                                                        data-bs-placement="left"></span>
              <span class="visually-hidden"><%= t("action.edit") %></span>
            <% end %>
            <%= link_to cable_path(cable),
                        method: :delete,
                        data: { confirm: t("action.confirm") },
                        class: "btn btn-danger" do %>
              <span class="bi bi-trash" title="<%= t("action.delete") %>" aria-hidden="true"
                                                                          data-controller="tooltip"
                                                                          data-bs-placement="left"></span>
              <span class="visually-hidden"><%= t("action.delete") %></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <% if @pagy.pages > 1 %>
        <%== pagy_bootstrap_nav(@pagy) %>
      <% end %>
    </div>
  <% end %>
</div>
