<% breadcrumb.add_step(title = @site.name) %>

<%= render Page::HeadingShowComponent.new(
      resource: @site,
      title:,
      breadcrumb:,
      editable: allowed_to?(:update?, @site),
    ) %>

<div class="col-12 p-4 border-top">
  <div class="row row-cols-1 row-cols-lg-2 row-gap-4">
    <div class="col">
      <%= render CardComponent.new do |card| %>
        <% card.with_header do %>
          <%= t("show.cards.identification") %>
        <% end %>

        <dl class="show-page_dl d-grid row-gap-2 mb-0">
          <% %i[name description].each do |attribute_name| %>
            <dt class="pb-2"><%= Site.human_attribute_name(attribute_name) %></dt>
            <dd class="mb-0 pb-2 ps-3"><%= @site.public_send(attribute_name) %></dd>
          <% end %>
        </dl>
      <% end %>

      <%= render CardComponent.new(extra_classes: "mt-4") do |card| %>
        <% card.with_header do %>
          <%= t("show.cards.display") %>
        <% end %>

        <dl class="show-page_dl d-grid row-gap-2 mb-0">
          <% %i[position].each do |attribute_name| %>
            <dt class="pb-2"><%= Site.human_attribute_name(attribute_name) %></dt>
            <dd class="mb-0 pb-2 ps-3"><%= @site.public_send(attribute_name) %></dd>
          <% end %>
        </dl>
      <% end %>

      <%= render HasManyTurboFrameComponent.new(
            ContactAssignment.model_name.human.pluralize,
            type: :warning,
            url: contact_assignments_path(site_ids: @site.id),
            frame_id: dom_id(ContactAssignment, :table),
            extra_classes: "bg-body-tertiary mt-4",
          ) do |c| %>
        <% c.with_actions do %>
          <% if allowed_to?(:update?, @site) %>
            <%= link_to edit_site_path(@site, anchor: "contact_assignments"),
                        class: "link-info link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover small" do %>
              <span class="bi bi-pencil"></span>
              <span><%= t("action.edit") %></span>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <div class="col">
      <%= render partial: "sites/location_block" %>
    </div>
  </div>

  <%= render CardComponent.new(extra_classes: "bg-body-tertiary mt-4") do |card| %>
    <% card.with_header do %>
      <%= t("show.cards.visualization") %>
    <% end %>

    <% if (rooms = authorized_scope(@site.rooms).order(:position).joins(:bays).distinct).any? %>
      <div class="row row-cols-1 row-gap-3">
        <% rooms.each do |room| %>
          <div class="col overview">
            <%= render "visualization/rooms/room_overview", room: room %>
          </div>
        <% end %>
      </div>
    <% else %>
      <%= render CardEmptyDataComponent.new(text: t("rooms.empty_overview")) %>
    <% end %>
  <% end %>

  <%= render HasManyTurboFrameComponent.new(
        Room.model_name.human.pluralize,
        url: rooms_path(site_ids: @site.id),
        frame_id: dom_id(Room, :table),
        new_path: (new_room_path(room: { site_id: @site.id }) if allowed_to?(:create?, with: RoomPolicy)),
        new_label: t("rooms.add_new"),
      ) %>

  <%= render ChangelogEntries::ObjectListComponent.new(@site) %>
</div>
