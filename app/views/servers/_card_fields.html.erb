<%
  composants = if local_assigns[:enclosure].present?
                 enclosure.composants.ordered.slots
               else
                 server.modele.composants.ordered.slots
               end
%>

<% if server.modele %>
  <div class="nested-form-wrapper list-group-item"
      data-new-record="<%= f.object.new_record? %>">
    <%= render CardComponent.new(extra_classes: "bg-body-tertiary") do |card| %>
      <div class="row g-2">
        <span class="col-12 col-sm-4 col-xl-3 mt-0">
          <%= f.label Enclosure.human_attribute_name(:composant_id), class: "form-label col-form-label-sm p-0" %>
          <%= f.select :composant_id,
                       options_for_select(composants.map { |c| [c.name || c.position, c.id] }, f.object.composant_id),
                       {},
                       { class: "form-select" } %>
        </span>
        <span class="col-12 mt-2 col-sm-3 col-xl-2 mt-sm-0">
          <%= f.label Enclosure.human_attribute_name(:name), class: "form-label col-form-label-sm p-0" %>
          <%= f.text_field :name, class: "form-control" %>
        </span>
        <span class="col-12 mt-2 col-sm-5 mt-sm-0 col-xl-7">
          <%= f.label Enclosure.human_attribute_name(:orientation), class: "form-label col-form-label-sm p-0" %>
          <%= f.select :orientation,
                       Card::ORIENTATIONS.map { |o| [Card.human_attribute_name("orientation.#{o}"), o] },
                       {},
                       { class: "form-select" } %>
        </span>
        <span class="col-12 mt-2 col-sm-4 col-xl-3 ">
          <%= f.label Enclosure.human_attribute_name(:card_type_id), class: "form-label col-form-label-sm p-0" %>
          <%= f.select :card_type_id,
                       options_for_select(CardType.sorted.map { |card_type| [card_type.name, card_type.id] },
                                          f.object.card_type_id),
                       {},
                       { class: "form-select", data: { controller: :select } } %>
        </span>
        <span class="col-12 mt-2 col-sm-3 col-xl-2">
          <%= f.label Enclosure.human_attribute_name(:first_position), class: "form-label col-form-label-sm p-0" %>
          <%= f.number_field :first_position, in: 0...101, class: "form-control" %>
        </span>
        <span class="col-12 mt-2 col-sm-5 col-xl-7">
          <%= f.label Enclosure.human_attribute_name(:twin_card_id), class: "form-label col-form-label-sm p-0" %>
          <%= f.select :twin_card_id,
                       options_for_select(Card.includes(:server, :composant, :card_type)
                                               .joins(:composant)
                                               .on_patch_panels.sort_by(&:to_s).map { |card| [card.to_s, card.id] },
                                          f.object.twin_card_id),
                       { include_blank: true },
                       { class: "form-select", data: { controller: :select } } %>
        </span>
      </div>

      <% card.with_footer do %>
        <span class="ms-auto">
          <%= f.hidden_field :_destroy %>
          <button type="button" data-action="nested-form#remove" class="btn btn-outline-danger btn-sm float-end">
            <span class="bi bi-trash me-1"></span>
            <span><%= t("action.delete") %></span>
          </button>
        </span>
      <% end %>
    <% end %>
  </div>
<% end %>
